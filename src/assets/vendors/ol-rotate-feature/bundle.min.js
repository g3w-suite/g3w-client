/*!
Rotate vector features interaction for OpenLayers

@package ol-rotate-feature
@author Vladimir Vershinin <ghettovoice@gmail.com>
@version 2.2.1
@licence MIT
@copyright (c) 2016-2019, Vladimir Vershinin <ghettovoice@gmail.com>
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("openlayers")):"function"==typeof define&&define.amd?define("ol-rotate-feature",["openlayers"],t):e.RotateFeatureInteraction=t(e.ol)}(this,function(e){"use strict";function t(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";if(t=["Assertion failed",t].join(": "),!e)throw new Error(t)}function a(e){return e}function s(e,t){return-1!==e.indexOf(t)}function u(e){return"[object Array]"===Object.prototype.toString.call(e)}e=e&&e.hasOwnProperty("default")?e.default:e;var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}}(),l=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},o=function e(t,r,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,o)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(o):void 0},n="rotatestart",i="rotating",f="rotateend",g=function(){function n(e,t,r,o){c(this,n),this.propagationStopped_=!1,this.type_=e,this.features_=t,this.angle_=r,this.anchor_=o}return r(n,[{key:"preventDefault",value:function(){this.propagationStopped_=!0}},{key:"stopPropagation",value:function(){this.propagationStopped_=!0}},{key:"propagationStopped",get:function(){return this.propagationStopped_}},{key:"type",get:function(){return this.type_}},{key:"features",get:function(){return this.features_}},{key:"angle",get:function(){return this.angle_}},{key:"anchor",get:function(){return this.anchor_}}]),n}(),_="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",p=-1!==_.indexOf("macintosh"),d=-1!==_.indexOf("webkit")&&-1==_.indexOf("edge"),y=function(e){var t=e.originalEvent;return 0==t.button&&!(d&&p&&t.ctrlKey)},v=e.interaction.Pointer,w=e.Collection,A=e.layer.Vector,F=e.source.Vector,m=e.Feature,b=e.geom.Point,k=e.geom.Polygon,C=e.geom.GeometryCollection,O=e.style.Style,E=e.style.RegularShape,x=e.style.Stroke,M=e.style.Fill,S=e.style.Text,P=e.extent.getCenter,j=e.events.condition.always,G=e.events.condition.mouseOnly,R="rotate-anchor",U="rotate-arrow",I="angle",T="anchor",z=function(e){function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};c(this,s);var t,r,o,n,a,i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,{handleDownEvent:D,handleUpEvent:N,handleDragEvent:V,handleMoveEvent:L}));if(i.previousCursor_=void 0,i.anchorFeature_=void 0,i.arrowFeature_=void 0,i.lastCoordinate_=void 0,i.anchorMoving_=!1,i.overlay_=new A({style:e.style||(r=[255,255,255,.8],o=[0,153,255,.8],n=[255,255,255,.01],l(t={},R,[new O({image:new E({fill:new M({color:[0,153,255,.8]}),stroke:new x({color:o,width:1}),radius:4,points:6}),zIndex:1/0})]),l(t,U,[new O({fill:new M({color:n}),stroke:new x({color:r,width:4}),text:new S({font:"12px sans-serif",offsetX:20,offsetY:-20,fill:new M({color:"blue"}),stroke:new x({color:r,width:3})}),zIndex:1/0}),new O({fill:new M({color:n}),stroke:new x({color:o,width:2}),zIndex:1/0})]),a=t,function(e,t){var r=void 0,o=e.get(I)||0;switch(!0){case e.get(R):return(r=a[R])[0].getImage().setRotation(-o),r;case e.get(U):r=a[U];var n=e.getGeometry().getCoordinates(),i=new k([[[n[0],n[1]-6*t],[n[0]+8*t,n[1]-12*t],[n[0],n[1]+30*t],[n[0]-8*t,n[1]-12*t],[n[0],n[1]-6*t]]]);return i.rotate(o,n),r[0].setGeometry(i),r[1].setGeometry(i),r[0].getText().setText(Math.round(180*-o/Math.PI)+"Â°"),r}}),source:new F({features:new w})}),i.condition_=e.condition?e.condition:j,i.features_=void 0,e.features)if(u(e.features))i.features_=new w(e.features);else{if(!(e.features instanceof w))throw new Error("Features option should be an array or collection of features, got "+h(e.features));i.features_=e.features}else i.features_=new w;return i.allowAnchorMovement=void 0===e.allowAnchorMovement||e.allowAnchorMovement,i.setAnchor(e.anchor||q(i.features_)),i.setAngle(e.angle||0),i.features_.on("add",i.onFeatureAdd_.bind(i)),i.features_.on("remove",i.onFeatureRemove_.bind(i)),i.on("change:"+I,i.onAngleChange_.bind(i)),i.on("change:"+T,i.onAnchorChange_.bind(i)),i.createOrUpdateAnchorFeature_(),i.createOrUpdateArrowFeature_(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,v),r(s,[{key:"setMap",value:function(e){this.overlay_.setMap(e),o(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"setMap",this).call(this,e)}},{key:"setActive",value:function(e){this.overlay_&&this.overlay_.setMap(e?this.map:void 0),o(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"setActive",this).call(this,e)}},{key:"setAngle",value:function(e){t(!isNaN(parseFloat(e)),"Numeric value passed"),this.set(I,parseFloat(e))}},{key:"getAngle",value:function(){return this.get(I)}},{key:"setAnchor",value:function(e){t(null==e||u(e)&&2===e.length,"Array of two elements passed"),this.set(T,null!=e?e.map(parseFloat):q(this.features_))}},{key:"getAnchor",value:function(){return this.get(T)}},{key:"createOrUpdateAnchorFeature_",value:function(){var e,t=this.getAngle(),r=this.getAnchor();r&&(this.anchorFeature_?(this.anchorFeature_.getGeometry().setCoordinates(r),this.anchorFeature_.set(I,t)):(this.anchorFeature_=new m((e={geometry:new b(r)},l(e,I,t),l(e,R,!0),e)),this.overlay_.getSource().addFeature(this.anchorFeature_)))}},{key:"createOrUpdateArrowFeature_",value:function(){var e,t=this.getAngle(),r=this.getAnchor();r&&(this.arrowFeature_?(this.arrowFeature_.getGeometry().setCoordinates(r),this.arrowFeature_.set(I,t)):(this.arrowFeature_=new m((e={geometry:new b(r)},l(e,I,t),l(e,U,!0),e)),this.overlay_.getSource().addFeature(this.arrowFeature_)))}},{key:"resetAngleAndAnchor_",value:function(){this.resetAngle_(),this.resetAnchor_()}},{key:"resetAngle_",value:function(){this.set(I,0,!0),this.arrowFeature_&&this.arrowFeature_.set(I,this.getAngle()),this.anchorFeature_&&this.anchorFeature_.set(I,this.getAngle())}},{key:"resetAnchor_",value:function(){this.set(T,q(this.features_),!0),this.getAnchor()&&(this.arrowFeature_&&this.arrowFeature_.getGeometry().setCoordinates(this.getAnchor()),this.anchorFeature_&&this.anchorFeature_.getGeometry().setCoordinates(this.getAnchor()))}},{key:"onFeatureAdd_",value:function(){this.resetAngleAndAnchor_(),this.createOrUpdateAnchorFeature_(),this.createOrUpdateArrowFeature_()}},{key:"onFeatureRemove_",value:function(){this.resetAngleAndAnchor_(),this.features_.getLength()?(this.createOrUpdateAnchorFeature_(),this.createOrUpdateArrowFeature_()):(this.overlay_.getSource().clear(),this.anchorFeature_=this.arrowFeature_=void 0)}},{key:"onAngleChange_",value:function(e){var t=this,r=e.oldValue;this.features_.forEach(function(e){return e.getGeometry().rotate(t.getAngle()-r,t.getAnchor())}),this.arrowFeature_&&this.arrowFeature_.set(I,this.getAngle()),this.anchorFeature_&&this.anchorFeature_.set(I,this.getAngle())}},{key:"onAnchorChange_",value:function(){var e=this.getAnchor();e&&(this.anchorFeature_&&this.anchorFeature_.getGeometry().setCoordinates(e),this.arrowFeature_&&this.arrowFeature_.getGeometry().setCoordinates(e))}},{key:"dispatchRotateStartEvent_",value:function(e){this.dispatchEvent(new g(n,e,this.getAngle(),this.getAnchor()))}},{key:"dispatchRotatingEvent_",value:function(e){this.dispatchEvent(new g(i,e,this.getAngle(),this.getAnchor()))}},{key:"dispatchRotateEndEvent_",value:function(e){this.dispatchEvent(new g(f,e,this.getAngle(),this.getAnchor()))}},{key:"features",get:function(){return this.features_}},{key:"angle",get:function(){return this.getAngle()},set:function(e){this.setAngle(e)}},{key:"anchor",get:function(){return this.getAnchor()},set:function(e){this.setAnchor(e)}},{key:"map",set:function(e){this.setMap(e)},get:function(){return this.getMap()}},{key:"active",set:function(e){this.setActive(e)},get:function(){return this.getActive()}}]),s}();function D(e){if(!G(e))return!1;if(y(e)&&this.condition_(e)){var t=e.map.forEachFeatureAtPixel(e.pixel,a);if(s(["click","singleclick","dblclick"],e.type)&&s([this.anchorFeature_,this.arrowFeature_],t))return!1;if(t&&!this.lastCoordinate_&&(s(this.features_.getArray(),t)||t===this.arrowFeature_))return this.lastCoordinate_=e.coordinate,L.call(this,e),this.dispatchRotateStartEvent_(this.features_),!0;if(t&&t===this.anchorFeature_&&this.allowAnchorMovement)return this.anchorMoving_=!0,L.call(this,e),!0}return!1}function N(e){return this.lastCoordinate_?(this.lastCoordinate_=void 0,L.call(this,e),this.dispatchRotateEndEvent_(this.features_),!0):!!this.anchorMoving_&&(this.anchorMoving_=!1,L.call(this,e),!0)}function V(e){var t=e.coordinate,r=this.anchorFeature_.getGeometry().getCoordinates();if(this.lastCoordinate_){var o=[this.lastCoordinate_[0]-r[0],this.lastCoordinate_[1]-r[1]],n=[t[0]-r[0],t[1]-r[1]],i=Math.atan2(o[0]*n[1]-n[0]*o[1],o[0]*n[0]+o[1]*n[1]);this.setAngle(this.getAngle()+i),this.dispatchRotatingEvent_(this.features_),this.lastCoordinate_=t}else this.anchorMoving_&&this.setAnchor(t)}function L(e){var t=e.map,r=e.pixel,o=t.getTargetElement(),n=t.forEachFeatureAtPixel(r,a),i=function(e){1<arguments.length&&void 0!==arguments[1]&&arguments[1]&&(o.style.cursor="-webkit-"+e,o.style.cursor="-moz-"+e),o.style.cursor=e};this.lastCoordinate_?(this.previousCursor_=o.style.cursor,i("grabbing",!0)):n&&(s(this.features_.getArray(),n)||n===this.arrowFeature_)?(this.previousCursor_=o.style.cursor,i("grab",!0)):n&&n===this.anchorFeature_&&this.allowAnchorMovement||this.anchorMoving_?(this.previousCursor_=o.style.cursor,i("crosshair")):(i(this.previousCursor_||""),this.previousCursor_=void 0)}function q(e){if((e=e instanceof w?e.getArray():e).length)return P(function(e){if((e=e instanceof w?e.getArray():e).length)return new C(e.map(function(e){return e.getGeometry()})).getExtent()}(e))}return"undefined"!=typeof window&&window.ol&&(window.ol.interaction.RotateFeature=z),z});
//# sourceMappingURL=bundle.min.js.map
